machine:
  environment:
    PATH: ${HOME}/.cargo/bin:${PATH}
dependencies:
  override:
    - curl https://sh.rustup.rs -sSf | sh -s -- -y
    - rustup target add x86_64-unknown-linux-musl
    - sed -i 's/github/git-non-exist-hub/g' ~/.gitconfig # https://github.com/rust-lang/cargo/issues/3900
compile:
  override:
    - cargo build --target=x86_64-unknown-linux-musl --release
  post:
    - mkdir -p $CIRCLE_ARTIFACTS/bin
    - mv target/x86_64-unknown-linux-musl/release/http-log-to-statsd $CIRCLE_ARTIFACTS/bin
test:
  override:
    - cargo test --target=x86_64-unknown-linux-musl
